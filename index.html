<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#2196f3" />
  <link rel="manifest" href="manifest.json">
  <title>Kのチャット</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet" />
  <link rel="stylesheet" href="/public/styles.css">
</head>
<body>  <header>
    <div class="header-inner">
      <div class="header-brand">
        <button id="sidebarToggle" type="button" class="header-icon-button" aria-label="ユーザー一覧を開閉" aria-expanded="false">
          <span aria-hidden="true">☰</span>
        </button>
        <h1>Kのチャット</h1>
      </div>
      <nav class="header-actions" aria-label="アクション">
        <button id="refreshApp" type="button" class="header-button" aria-label="表示を更新">
          <span aria-hidden="true">🔄</span>
          <span class="label">更新</span>
        </button>
        <button id="themeToggle" type="button" class="header-button" aria-pressed="false" aria-label="テーマを切り替え">
          <span aria-hidden="true">🌗</span>
          <span class="label">テーマ</span>
        </button>
        <button id="openAdmin" type="button" class="header-button">
          <span aria-hidden="true">🛠️</span>
          <span class="label">ルーム管理</span>
        </button>
        <div class="header-menu">
          <button id="moreActions" type="button" class="header-icon-button" aria-haspopup="true" aria-expanded="false" aria-label="追加アクション">
            <span aria-hidden="true">⋯</span>
          </button>
          <div id="quickActionsMenu" class="header-menu-panel" role="menu" aria-hidden="true">
            <button id="shareLocation" type="button" role="menuitem">
              <span aria-hidden="true">📍</span>
              <span>位置を1回共有</span>
            </button>
            <button id="toggleLocationShare" type="button" role="menuitem" aria-pressed="false">
              <span aria-hidden="true">🛰️</span>
              <span>位置共有を開始</span>
            </button>
          </div>
        </div>
      </nav>
    </div>
    <div id="connectionBanner" class="connection-banner" role="status" aria-live="polite"></div>
  </header>
  <main id="appContent" class="hidden">
    <section id="profile">
      <div class="icon-editor">
        <label>
          アイコンを選択
          <input id="iconInput" type="file" accept="image/*" />
        </label>
        <img id="iconPreview" src="icon-192.png" alt="アイコンのプレビュー" />
      </div>
      <p id="iconStatus" class="profile-status" aria-live="polite"></p>
    </section>

    <section id="chatLayout">
      <aside id="roomUsers" aria-label="入室中のユーザー" data-visible="true">
        <div class="room-users-header">
          <h2>入室中のユーザー</h2>
          <button id="closeSidebar" type="button" class="header-icon-button" aria-label="ユーザー一覧を閉じる">
            <span aria-hidden="true">✕</span>
          </button>
        </div>
        <ul id="roomUserList">
          <li class="empty">まだユーザーはいません。</li>
        </ul>
      </aside>
      <div id="chatPanel">
        <section id="chat" aria-label="チャット履歴">
          <div id="chatScrollRegion">
            <ul id="messages"></ul>
          </div>
          <button id="newMessagesButton" type="button" class="new-messages" aria-live="polite">
            新しいメッセージ
          </button>
        </section>
        <div id="typingIndicator" role="status" aria-live="polite"></div>
        <section id="controls" aria-label="メッセージ送信">
          <label class="sr-only" for="input">メッセージを入力</label>
          <input id="input" type="text" placeholder="メッセージを入力…" autocomplete="off" />
          <div class="control-buttons">
            <button id="send" type="button">送信</button>
          </div>
        </section>
        <section id="liveMapPanel" aria-label="ライブ位置情報">
          <div class="live-map-header">
            <h2>ライブマップ</h2>
            <p id="liveMapStatus" class="live-map-status" aria-live="polite">ルームに参加すると位置情報が表示されます。</p>
          </div>
          <div id="liveMap" role="img" aria-label="共有された最新の位置情報を表示する地図"></div>
        </section>
      </div>
    </section>

    <section id="callControls">
      <div class="buttons">
        <button id="startCall">通話を開始</button>
        <button id="endCall" disabled>通話を終了</button>
      </div>
      <div id="callParticipants">
        <h2>通話参加者</h2>
        <ul id="participantList">
          <li class="empty">現在、通話に参加しているユーザーはいません。</li>
        </ul>
      </div>
      <div id="audioElements" aria-hidden="true"></div>
    </section>
  </main>

  <div id="joinModal" role="dialog" aria-modal="true">
    <div class="modal-content">
      <h2>ルームに参加</h2>
      <label>
        ルーム名
        <input id="roomNameInput" type="text" placeholder="ルーム名" autocomplete="off" list="roomOptions" />
        <datalist id="roomOptions"></datalist>
      </label>
      <label>
        ユーザー名
        <input id="userNameInput" type="text" placeholder="ユーザー名" autocomplete="nickname" />
      </label>
      <label>
        ルームのパスワード
        <input id="passwordInput" type="password" placeholder="パスワード" autocomplete="current-password" />
      </label>
      <p id="joinError" aria-live="polite"></p>
      <button id="joinRoom">ルームに参加</button>
      <button id="createRoomButton" type="button">新しいルームを作成</button>
      <p id="createRoomMessage" aria-live="polite"></p>
    </div>
  </div>

  <div id="adminModal" class="hidden" role="dialog" aria-modal="true">
    <div class="modal-content">
      <button id="closeAdmin" type="button" aria-label="閉じる">×</button>
      <h2>ルーム管理</h2>
      <button id="leaveRoomBtn" type="button" class="secondary-button">参加中のルームはありません</button>
      <section id="adminLoginSection">
        <label>
          管理者パスワード
          <input id="adminPasswordInput" type="password" placeholder="管理者パスワード" autocomplete="current-password" />
        </label>
        <button id="adminLoginBtn" type="button">ログイン</button>
      </section>
      <section id="adminPanel" class="hidden">
        <form id="createRoomForm">
          <h3>ルームを追加</h3>
          <label>
            ルーム名
            <input id="newRoomName" type="text" placeholder="新しいルーム名" autocomplete="off" />
          </label>
          <label>
            ルームのパスワード
            <input id="newRoomPassword" type="password" placeholder="ルームのパスワード" autocomplete="new-password" />
          </label>
          <button type="submit">追加</button>
        </form>
        <div class="admin-room-list-wrapper">
          <h3>既存のルーム</h3>
          <ul id="adminRoomList"></ul>
        </div>
      </section>
      <p id="adminError" aria-live="polite"></p>
    </div>
  </div>

      <script src="/socket.io/socket.io.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script type="module" src="/src/main.js"></script>
